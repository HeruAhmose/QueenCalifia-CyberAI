# QueenCalifia CyberAI - environment template
# Copy to `.env` and set real secrets (do NOT commit secrets).

# ---------------------------------------------------------------------------
# REQUIRED in production
# ---------------------------------------------------------------------------
QC_API_KEY_PEPPER=CHANGE_ME__LONG_RANDOM
QC_AUDIT_HMAC_KEY=CHANGE_ME__LONG_RANDOM

# Initial local bootstrap of keys.json for compose (disable after provisioning)
QC_ALLOW_INSECURE_BOOTSTRAP=1

# ---------------------------------------------------------------------------
# Redis (required for distributed rate-limit + budgeting + scan queue)
# ---------------------------------------------------------------------------
QC_REDIS_URL=redis://localhost:6379/0
QC_USE_CELERY=1
QC_REQUIRE_REDIS=0  # set to 1 in production (readyz will require Redis)

# ---------------------------------------------------------------------------
# Safe-by-default scan policy
# ---------------------------------------------------------------------------
QC_DENY_PUBLIC_TARGETS=1
QC_SCAN_ALLOWLIST=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,127.0.0.0/8

# ---------------------------------------------------------------------------
# Global request budgeting (token bucket; weighted per-endpoint costs)
# ---------------------------------------------------------------------------
QC_BUDGET_ENABLED=1
QC_FORCE_REDIS_BUDGET=1
QC_BUDGET_ROLE_BUCKETS_JSON={"admin":{"capacity":1200,"refill_per_minute":600},"analyst":{"capacity":600,"refill_per_minute":240},"reader":{"capacity":300,"refill_per_minute":120},"public":{"capacity":120,"refill_per_minute":60}}
QC_BUDGET_ENDPOINT_COSTS_JSON={"GET /api/*":1,"POST /api/events/ingest":3,"POST /api/vulns/scan":25,"POST /api/incidents/<incident_id>/approve/<action_id>":4,"POST /api/incidents/<incident_id>/deny/<action_id>":2,"POST /api/incidents/<incident_id>/rollback/<action_id>":6}

# ---------------------------------------------------------------------------
# OpenTelemetry (apps -> otel-collector -> Jaeger + Tempo + file)
# Tail-sampling happens in the collector, so recommend an always-on SDK sampler.
# ---------------------------------------------------------------------------
QC_OTEL_ENABLED=1
OTEL_TRACES_EXPORTER=otlp
OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
OTEL_SERVICE_NAME=queencalifia-api

OTEL_TRACES_SAMPLER=always_on

# Collector tail-sampling knobs (see observability/otel-collector.yaml)
QC_OTEL_SAMPLING_PERCENTAGE=25
QC_OTEL_LATENCY_THRESHOLD_MS=2000
QC_OTEL_TAIL_DECISION_WAIT=10s
QC_OTEL_TAIL_NUM_TRACES=50000
QC_OTEL_TAIL_EXPECTED_NEW_TRACES_PER_SEC=2000

# ---------------------------------------------------------------------------
# Loadtest (k6)
# ---------------------------------------------------------------------------
QC_K6_EXPECT_BUDGET_HEADERS=1

# Metrics (Prometheus scrape auth; enforced when QC_PRODUCTION=1)
QC_METRICS_TOKEN=metrics-dev

# Grafana
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# Prometheus remote_write (optional)
QC_PROM_REMOTE_WRITE_URL=
QC_PROM_REMOTE_WRITE_BEARER_TOKEN=
QC_PROM_REMOTE_WRITE_BASIC_USER=
QC_PROM_REMOTE_WRITE_BASIC_PASSWORD=

# Grafana alert notifications (optional; if unset, no contact point/policy is provisioned)
QC_ALERT_WEBHOOK_URL=
QC_ALERT_WEBHOOK_BEARER_TOKEN=

# Optional parity controls for smoketest/provisioning
QC_ALERT_WEBHOOK_METHOD=POST
QC_ALERT_WEBHOOK_DISABLE_RESOLVE=0

# Redis TLS probe (Makefile prefers QC_REDIS_URL if reachable)
QC_REDIS_TLS=0
QC_REDIS_TLS_INSECURE=0

# Smoketest identity guards
QC_GRAFANA_CONTACTPOINT_NAME=qc-webhook
QC_GRAFANA_CONTACTPOINT_UID=qc-webhook
QC_GRAFANA_RECEIVER_UID=qc-webhook-1
QC_SMOKETEST_ALLOW_MISSING_UID=0

# Redis mutual TLS (probe only; app TLS is handled by your Redis client)
QC_REDIS_TLS_CA=
QC_REDIS_TLS_CERT=
QC_REDIS_TLS_KEY=

QC_GRAFANA_RECEIVER_UIDS=qc-webhook-1

# Redis TLS hostname override (SNI + cert hostname validation)
QC_REDIS_TLS_SERVERNAME=

# Redis cert pinning (SHA256 of DER SubjectPublicKeyInfo; hex or base64; comma-separated)
# Requires TLS: use rediss:// or set QC_REDIS_TLS=1
QC_REDIS_TLS_SPKI_SHA256=

# Smoketest hardening: minimum number of webhook receivers required
QC_GRAFANA_MIN_WEBHOOK_RECEIVERS=1

# Smoketest flexibility: allow additional webhook receivers after expected prefix
QC_SMOKETEST_ALLOW_EXTRA_WEBHOOKS=0

# Smoketest: optionally compare receiver UIDs case-insensitively
QC_SMOKETEST_UID_CASE_INSENSITIVE=0

# Smoketest: diff context window size (items around first mismatch)
QC_SMOKETEST_DIFF_WINDOW=2

# Note: setting QC_REDIS_TLS_CA requires TLS (rediss:// or QC_REDIS_TLS=1)

# JSONL writer lock settings (for concurrent runbooks)
QC_JSONL_LOCK_TIMEOUT_SEC=5.0
QC_JSONL_LOCK_BACKOFF_MS=50
QC_JSONL_LOCK_MAX_BACKOFF_MS=500

# Makefile: suppress Redis TLS scheme warnings
QC_SUPPRESS_TLS_WARNINGS=0

# SPKI runbook: retry lock timeout (exit 2)
QC_SPKI_RETRY_LOCK_TIMEOUT=0

# Runbook wrapper: emit JSON summary (appends to --out JSONL when provided)
QC_SPKI_SUMMARY_JSON=0

# Runbook wrapper: emit per-retry attempt JSON record (appends to --out JSONL when provided)
QC_SPKI_ATTEMPT_JSON=0

# SPKI log file path (read by dashboard API)
QC_SPKI_LOG_FILE=data/spki.jsonl


# ---------------------------------------------------------------------------
# Edge TLS / ACME (docker-compose.prod.edge.yml)
# ---------------------------------------------------------------------------
# For local dev (self-signed): leave QC_DOMAIN/QC_EMAIL empty.
# For real deployments (Let's Encrypt): set both and run with --profile acme.
QC_DOMAIN=
QC_EMAIL=
QC_LETSENCRYPT_STAGING=0
QC_HTTP_PORT=80
QC_HTTPS_PORT=443
QC_TLS_CN=localhost
